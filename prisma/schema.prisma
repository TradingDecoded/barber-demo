generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Demo {
  id          String    @id @default(uuid())
  slug        String    @unique
  shopName    String
  ownerName   String
  email       String
  phone       String
  logoUrl     String?
  accentColor String    @default("#8b5cf6")
  colorPalette String?
  bookingWindowDays Int @default(60)
  timezone    String    @default("America/New_York")
  onboarded   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  
  // Website content
  tagline         String?
  heroSubtitle    String?
  heroImageUrl    String?
  aboutTitle      String?
  aboutText1      String?   @db.Text
  aboutText2      String?   @db.Text
  aboutSignature  String?
  aboutImageUrl   String?
  address         String?
  instagramUrl    String?
  facebookUrl     String?
  
  services      Service[]
  bookings      Booking[]
  hours         BusinessHours[]
  blockedDates  BlockedDate[]
  staff         Staff[]
  galleryImages GalleryImage[]
}

model Staff {
  id        String   @id @default(uuid())
  demoId    String
  demo      Demo     @relation(fields: [demoId], references: [id], onDelete: Cascade)
  name      String
  phone     String?
  photoUrl  String?
  bio       String?
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  photoUploadToken  String?  @unique
  photoUploadExpires DateTime?
  createdAt DateTime @default(now())
  
  hours     StaffHours[]
  services  StaffService[]
  bookings  Booking[]
}

model StaffHours {
  id        String  @id @default(uuid())
  staffId   String
  staff     Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  day       Int     // 0 = Sunday, 1 = Monday, etc.
  isOpen    Boolean @default(true)
  openTime  String  @default("09:00")
  closeTime String  @default("18:00")

  @@unique([staffId, day])
}

model StaffService {
  id        String  @id @default(uuid())
  staffId   String
  staff     Staff   @relation(fields: [staffId], references: [id], onDelete: Cascade)
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@unique([staffId, serviceId])
}

model BusinessHours {
  id        String  @id @default(uuid())
  demoId    String
  demo      Demo    @relation(fields: [demoId], references: [id], onDelete: Cascade)
  day       Int     // 0 = Sunday, 1 = Monday, etc.
  isOpen    Boolean @default(true)
  openTime  String  @default("09:00")
  closeTime String  @default("18:00")

  @@unique([demoId, day])
}

model Service {
  id              String    @id @default(uuid())
  demoId          String
  demo            Demo      @relation(fields: [demoId], references: [id], onDelete: Cascade)
  name            String
  durationMinutes Int
  price           Int
  createdAt       DateTime  @default(now())
  bookings        Booking[]
  staffServices   StaffService[]
}

model Booking {
  id              String   @id @default(uuid())
  demoId          String
  demo            Demo     @relation(fields: [demoId], references: [id], onDelete: Cascade)
  serviceId       String
  service         Service  @relation(fields: [serviceId], references: [id])
  staffId         String?
  staff           Staff?   @relation(fields: [staffId], references: [id])
  customerName    String
  customerPhone   String
  customerEmail   String?
  appointmentTime DateTime
  status          String   @default("confirmed")
  reminderSent    Boolean  @default(false)
  reviewSent      Boolean  @default(false)
  wasAutoAssigned Boolean  @default(false)
  recurringGroupId String?
  recurringType   String?
  manageToken     String?  @unique
  createdAt       DateTime @default(now())
}

model BlockedDate {
  id        String   @id @default(uuid())
  demoId    String
  demo      Demo     @relation(fields: [demoId], references: [id], onDelete: Cascade)
  date      DateTime
  reason    String?
  createdAt DateTime @default(now())

  @@unique([demoId, date])
}

model GalleryImage {
  id        String   @id @default(uuid())
  demoId    String
  demo      Demo     @relation(fields: [demoId], references: [id], onDelete: Cascade)
  imageUrl  String
  altText   String?
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
}